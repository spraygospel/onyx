# 1.2 LLM Configuration UI Changes Development Plan

## üéØ Objective
Modify the LLM configuration UI behavior in Onyx:
1. Change "here" link to redirect to admin configuration page instead of popup
2. Auto-hide message when LLM is configured
3. Remove initial popup modal on startup

## üìã Current UI Analysis

### UI Elements Identified

**1. Configuration Message**
- **File**: `web/src/components/chat/UnconfiguredLlmProviderText.tsx`
- **Line 28-36**: Contains the message text and "here" button
- **Current Behavior**: Clicking "here" triggers `showConfigureAPIKey()` function which opens modal
- **Parent Component**: `ChatInputBar.tsx` (line 586-587)

**2. Initial Popup Modal**
- **File**: `web/src/components/llm/ApiKeyModal.tsx`
- **Title**: "Configure a Generative AI Model"
- **Trigger Location**: `web/src/app/chat/ChatPage.tsx`
  - Line 369-371: `showApiKeyModal` state initialization
  - Line 2468-2473: Modal rendering condition
- **Current Behavior**: Shows automatically on first startup when no LLM configured

**3. Provider Status Context**
- **Hook**: `useProviderStatus()` from `ProviderContext`
- **Key Property**: `shouldShowConfigurationNeeded`
- **Controls**: Whether to show unconfigured message

## üîç Code Flow Analysis

### Current Flow
```
1. ChatPage loads
   ‚Üì
2. Checks if LLM configured via useProviderStatus()
   ‚Üì
3. If not configured:
   a. Shows ApiKeyModal popup (line 2468-2473)
   b. Shows UnconfiguredLlmProviderText message
   ‚Üì
4. Clicking "here" in message ‚Üí showConfigureAPIKey() ‚Üí setShowApiKeyModal(true)
   ‚Üì
5. Opens modal popup for configuration
```

### Desired Flow
```
1. ChatPage loads
   ‚Üì
2. Checks if LLM configured via useProviderStatus()
   ‚Üì
3. If not configured:
   a. ‚ùå NO popup modal
   b. ‚úÖ Shows UnconfiguredLlmProviderText message
   ‚Üì
4. Clicking "here" in message ‚Üí Redirect to /admin/configuration/llm
   ‚Üì
5. Admin page handles configuration
```

## üöÄ Implementation Plan

### Phase 1: Remove Initial Popup Modal

**1.1 Disable Auto-Show Modal**
- **File**: `web/src/app/chat/ChatPage.tsx`
- **Line 369-371**: Change initialization logic

**Current Code:**
```tsx
const [showApiKeyModal, setShowApiKeyModal] = useState(
  !shouldShowWelcomeModal
);
```

**Modified Code:**
```tsx
const [showApiKeyModal, setShowApiKeyModal] = useState(false);
```

**Alternative Approach (Keep for manual trigger):**
- Keep the state but always initialize to `false`
- Remove the modal rendering entirely (lines 2468-2473)

### Phase 2: Change "here" Link Behavior

**2.1 Modify UnconfiguredLlmProviderText Component**
- **File**: `web/src/components/chat/UnconfiguredLlmProviderText.tsx`
- **Lines 28-36**: Replace button with link

**Current Code:**
```tsx
<button
  onClick={showConfigureAPIKey}
  className="text-link hover:underline cursor-pointer"
>
  here
</button>
```

**Modified Code:**
```tsx
<a
  href="/admin/configuration/llm"
  className="text-link hover:underline cursor-pointer"
>
  here
</a>
```

**2.2 Remove showConfigureAPIKey Prop**
Since we're no longer using the callback, we can remove it from:
- Component props definition (line 4-8)
- Parent component props passing (ChatInputBar.tsx line 587)
- ChatPage.tsx prop passing (line 3480)

### Phase 3: Auto-Hide Message When Configured

**3.1 Verify Current Logic**
- **Already Implemented**: The message already auto-hides!
- **Logic**: `shouldShowConfigurationNeeded && ( ... )`
- **File**: `UnconfiguredLlmProviderText.tsx` line 26
- **When LLM is configured**: `shouldShowConfigurationNeeded` becomes `false`
- **Result**: Message automatically disappears

**No changes needed for this requirement!** ‚úÖ

## üìÅ Files to Modify

### Primary Changes
1. **`web/src/app/chat/ChatPage.tsx`**
   - Line 369-371: Change `showApiKeyModal` initialization to `false`
   - Lines 2468-2473: Optionally remove modal rendering code
   - Line 3480: Remove `showConfigureAPIKey` prop passing

2. **`web/src/components/chat/UnconfiguredLlmProviderText.tsx`**
   - Line 4-8: Remove `showConfigureAPIKey` from props interface
   - Lines 30-35: Replace button with anchor tag to `/admin/configuration/llm`

3. **`web/src/app/chat/input/ChatInputBar.tsx`**
   - Line 176: Remove `showConfigureAPIKey` from props interface
   - Line 209: Remove from destructured props
   - Line 587: Remove prop passing to UnconfiguredLlmProviderText

### Optional Cleanup
4. **`web/src/components/llm/ApiKeyModal.tsx`**
   - Can be kept for other uses or removed if not needed elsewhere
   - Used in `NRFPage.tsx` as well, so better to keep it

## üß™ Testing Strategy

### Manual Testing Steps
1. **Initial State Testing**
   - Start with no LLM configured
   - Verify NO popup appears on page load
   - Verify message "Please note that you have not yet configured..." appears

2. **Link Testing**
   - Click "here" link in message
   - Verify redirect to `/admin/configuration/llm`
   - Verify admin page loads correctly

3. **Configuration Testing**
   - Configure an LLM provider in admin page
   - Return to chat page
   - Verify message is automatically hidden
   - Verify chat functionality works

4. **Regression Testing**
   - Verify other LLM configuration flows still work
   - Test NRFPage (which also uses ApiKeyModal)
   - Ensure no console errors

### Edge Cases
- Multiple browser tabs open during configuration
- Page refresh after configuration
- Back button behavior after redirect
- Direct URL access to chat page

## üìä Success Criteria

1. ‚úÖ No popup modal on initial startup
2. ‚úÖ "here" link redirects to `/admin/configuration/llm`
3. ‚úÖ Message auto-hides when LLM is configured
4. ‚úÖ No console errors or warnings
5. ‚úÖ Smooth user experience for configuration flow
6. ‚úÖ No regression in existing functionality

## üöß Implementation Notes

### Considerations
- **Next.js Routing**: Using `href` for internal navigation is fine, but could also use Next.js `Link` component for client-side navigation
- **State Management**: Current state management through ProviderContext works well
- **Backward Compatibility**: Changes should not affect existing users with configured LLMs

### Alternative Approaches

**Option A: Use Next.js Link Component**
```tsx
import Link from 'next/link';

<Link href="/admin/configuration/llm" className="text-link hover:underline cursor-pointer">
  here
</Link>
```

**Option B: Use Router Push**
```tsx
import { useRouter } from 'next/navigation';

const router = useRouter();

<button
  onClick={() => router.push('/admin/configuration/llm')}
  className="text-link hover:underline cursor-pointer"
>
  here
</button>
```

**Recommendation**: Use Option A (Link component) for better Next.js integration and prefetching.

## üí° Additional Improvements (Optional)

1. **Improved Message Text**
   - Current: "Please note that you have not yet configured an LLM provider. You can configure one here."
   - Suggested: "No LLM provider configured. Configure one in settings."

2. **Add Icon to Link**
   - Add external link icon to indicate navigation
   - Use settings icon for better UX

3. **Toast Notification**
   - After successful configuration, show success toast
   - Guide user back to chat interface

## üìã Implementation Order

1. Remove initial popup (Phase 1) - Quick win
2. Change link behavior (Phase 2) - Main requirement
3. Test auto-hide behavior (Phase 3) - Verify existing functionality
4. Clean up unused props and code
5. Add improvements if time permits